<!DOCTYPE ejs>
<html>
<head>
    <title>YouTube Downloader</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel ="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel ="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="/css/yt.css">
</head>

<body>
    <header>
        <ul>
            <li><a href="../" style="text-decoration: none;"><img class="logo" src="/logo2.png">Tubemate</a></li>
            <li><a href="../video/<%=vidId%>">Video</a></li>
            <li><a href="/playlist">Play List</a></li>
            <li><a href="https://www.youtube.com/" target=”_blank”><img id="utube" src="/youtube.png"></a></li>
            <li style="flex-grow: 1; border:none"> </li>
            <li><a href="" >Copyrights</a></li>
        </ul>
    </header>

    <div class="cont">

        <form action="../audio/convert" method="post" class="opt-cont" onsubmit="return validateForm()">

            <div class="data">

                <!-- Redirection to new -->
                <div class="panel panel-default">
                    <div class="panel-heading">Generate New</div>
                    <div class="panel-body">
                        <div class="link">  
                            <label for="in">Link: </label>
                            <input id="in" type="text" name="link" value="https://www.youtube.com/watch?v=<%=vidId%>">
                        </div>
                        <button class="btn btn-info" id="b1" onclick="route(event)">Generate</button>        
                    </div>                
                </div>

                <!-- Name of the file -->
                <div class="panel panel-default">
                    <div class="panel-heading">File Name</div>
                    <div class="panel-body">
                        <label for="fileName">File name: </label>
                        <input type="text" id="fileName" name="fileName" value="<%=title%>">
                    </div>
                </div>

                <!-- ID3 Data (Optional)-->
                 <div class="panel panel-default">
                    <button class="panel-heading" id="collapsible" onclick="show(event)">Edit ID3 Tags</button>
                    <input id="id3" name="id3" style="display: none" value="0">
                    <div id="meta-data">
                        <label for="title">Title: </label>
                        <input type="text" name="title" id="title" value="<%=title%>" onchange=""><br>
                        <label for="artist">Artist: </label>
                        <input type="text" name="artist" id="artist" maxlength="20" value onchange=""><br>
                        <label for="album">Album: </label>
                        <input type="text" name="album" id="album" maxlength="20" value onchange=""><br>
                        <label for="year">Year: </label>
                        <input type="number" name="year" id="year" maxlength="4" value onchange=""><br>
                        <label for="comnt">Comment: </label>
                        <input type="text"  name="cmnt" id="cmnt" onchange="">
                    </div>
                </div>
            </div>

            <div class="preview">
                <!-- Preview -->
                <div class="panel panel-default" id="vid">
                    <div class="panel-heading">Preview</div>
                    <div class="panel-body">
                        <iframe width="622" height="350" src="https://www.youtube-nocookie.com/embed/<%=vidId%>" id="pre1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                    </div>
                </div>
                
                <!-- Quality -->
                <div class="panel panel-default">
                    <div class="panel-heading">Quality</div>
                    <div class="panel-body" id="quality">
                        <label for="audio_bitrate">Quality:</label>
                        <select id="audio_bitrate" name="quality" >
                            <option value="0">High</option>
                            <option value="5">Medium</option>
                            <option value="10">Lowest</option>
                        </select>
                        <button class="btn btn-info" id="b1" type="submit">Download</button>
                    </div>
                </div>              
            </div>

        </form>
    </div>

</body>

<script>
    var a=0;
    function show(event){
        event.preventDefault();
        const id3= document.getElementById("id3");
        const cont = document.getElementById("meta-data");
        if( a==0 ){
            cont.style.display="block";
            a=1;
            id3.value=1;
            console.log("id3",1);
        }
        else{
            cont.style.display="none";
            a=0;
            id3=0;
        }
        return false; // Needs to added to ensure the form is not submitted
    }

    function getVidId(url) {
        var regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;
        var match = url.match(regExp);
        if (match && match[7].length == 11) {
            return match[7];
        }else 
            return 'Invalid YouTube URL';
    }

    function route(event){
        event.preventDefault(); // Prevent the default form submission

        const link = document.getElementById("in").value;

        const vidId= getVidId(link);    

        window.location.href = `/audio/${vidId}`;
    }
</script>

</html>